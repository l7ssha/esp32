substitutions:
  device_name: Weather Station
  name: weather-station

esphome:
  name: ${name}
  comment: ${device_name}
  friendly_name: ${device_name}
  name_add_mac_suffix: true
  project:
    name: l7ssha.weather-station
    version: "1.0"
  includes:
    - GP2Y1010AU0F.h

dashboard_import:
  package_import_url: github://l7ssha/esphome/weather-station.yaml@main
  import_full_config: false

esp32:
  board: upesy_wroom
  framework:
    type: arduino

logger:

api:

ota:

wifi:
  power_save_mode: none
  ap:
    ssid: "${name} Hotspot"
    password: "${name}"

captive_portal:

i2c:
  sda: 21
  scl: 22

sensor:
  - platform: dht
    pin: GPIO5
    model: DHT22
    temperature:
      name: "Outside Temperature DHT22"
      accuracy_decimals: 2
      id: air_temperature
    humidity:
      name: "Outside Humidity"
      accuracy_decimals: 2
      id: relative_humidity
    update_interval: 60s

  - platform: dps310
    temperature:
      name: "Outside Temperature DPS310"
      accuracy_decimals: 2
    pressure:
      name: "Outside Pressure"
      accuracy_decimals: 2
      id: air_pressure
    address: 0x77
    update_interval: 60s

  - platform: absolute_humidity
    name: Outside Absolute Humidity
    temperature: air_temperature
    humidity: relative_humidity

  - platform: template
    name: "Dew Point"
    lambda: |-
      return (243.5*(log(id(relative_humidity).state/100)+((17.67*id(air_temperature).state)/
      (243.5+id(air_temperature).state)))/(17.67-log(id(relative_humidity).state/100)-
      ((17.67*id(air_temperature).state)/(243.5+id(air_temperature).state))));
    unit_of_measurement: °C
    icon: 'mdi:thermometer-alert'
    accuracy_decimals: 2
    update_interval: 60s

  - platform: template
    name: "Equivalent sea level pressure"
    lambda: |-
      const float STANDARD_ALTITUDE = 195; // in meters, see note
      return id(air_pressure).state / powf(1 - ((0.0065 * STANDARD_ALTITUDE) /
        (id(air_pressure).state + (0.0065 * STANDARD_ALTITUDE) + 273.15)), 5.257); // in hPa
    update_interval: 60s
    unit_of_measurement: 'hPa'
    accuracy_decimals: 2
    id: sea_air_pressure

  - platform: custom
    lambda: |-
      auto dust_sensor = new GP2Y1010AU0F();
      App.register_component(dust_sensor);
      return {dust_sensor};
    sensors:
      name: "PM2.5 Dust Sensor"
      accuracy_decimals: 2
      unit_of_measurement: "µg/m³"
      icon: "mdi:smog"

  - platform: tsl2591
    name: "TSL2591"
    address: 0x29
    update_interval: 60s
    gain: auto
    device_factor: 53
    glass_attenuation_factor: 14.4
    visible:
      name: "TSL2591 visible light"
    infrared:
      name: "TSL2591 infrared light"
    full_spectrum:
      name: "TSL2591 full spectrum light"
    calculated_lux:
      id: i_lux
      name: "TSL2591 Lux"
    actual_gain:
      id: "actual_gain"
      name: "TSL2591 actual gain"

  - platform: wifi_signal
    name: "WiFi Signal"
    update_interval: 60s
    entity_category: "diagnostic"

  - platform: uptime
    name: Uptime
    entity_category: "diagnostic"

button:
  - platform: factory_reset
    name: "Restart with Factory Default Settings"
    entity_category: "config" 

  - platform: restart
    name: "Restart"
    entity_category: "config"

text_sensor:
  - platform: wifi_info
    ip_address:
      name: "IP Address"
    ssid:
      name: "Connected SSID"
    mac_address:
      name: "Mac Address"
